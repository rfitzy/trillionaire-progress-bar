"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const asynciterablex_1 = require("./asynciterablex");
const returniterator_1 = require("../internal/returniterator");
class CatchWithAsyncIterable extends asynciterablex_1.AsyncIterableX {
    constructor(source, handler) {
        super();
        this._source = source;
        this._handler = handler;
    }
    async *[Symbol.asyncIterator]() {
        let err, hasError = false, it = this._source[Symbol.asyncIterator]();
        while (1) {
            let c = {};
            try {
                c = await it.next();
                if (c.done) {
                    await returniterator_1.returnAsyncIterator(it);
                    break;
                }
            }
            catch (e) {
                err = await this._handler(e);
                hasError = true;
                await returniterator_1.returnAsyncIterator(it);
                break;
            }
            yield c.value;
        }
        if (hasError) {
            for await (let item of err) {
                yield item;
            }
        }
    }
}
exports.CatchWithAsyncIterable = CatchWithAsyncIterable;
function catchWith(source, handler) {
    return new CatchWithAsyncIterable(source, handler);
}
exports.catchWith = catchWith;

//# sourceMappingURL=catchwith.js.map
