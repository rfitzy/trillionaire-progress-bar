{"version":3,"sources":["asynciterable/publish.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,MAAM,EAAE,MAAM,UAAU,CAAC;AAClC,OAAO,EAAE,kBAAkB,EAAE,MAAM,WAAW,CAAC;AAE/C,OAAO,EAAE,YAAY,EAAE,MAAM,2BAA2B,CAAC;AAEzD,MAAM,oBAAwB,SAAQ,kBAAqB;IAIzD,YAAY,MAAwB;QAClC,KAAK,CAAC,MAAM,EAAE,IAAI,YAAY,CAAI,CAAC,CAAC,CAAC,CAAC;IACxC,CAAC;IAED,CAAC,MAAM,CAAC,aAAa,CAAC;QACpB,IAAI,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC;QAC3B,OAAO,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,MAAM,CAAC,aAAa,CAAC,EAAE,CAAC;IACvE,CAAC;CACF;AAOD,MAAM,UAAU,OAAO,CACrB,MAA8B,EAC9B,QAAoE;IAEpE,OAAO,QAAQ;QACb,CAAC,CAAC,MAAM,CAAC,KAAK,IAAI,EAAE,CAAC,QAAQ,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,aAAa,CAAC,EAAE,CAAC;QACvE,CAAC,CAAC,IAAI,oBAAoB,CAAU,MAAM,CAAC,MAAM,CAAC,aAAa,CAAC,EAAE,CAAC,CAAC;AACxE,CAAC","file":"publish.js","sourcesContent":["import { create } from './create';\nimport { MemoizeAsyncBuffer } from './memoize';\nimport { AsyncIterableX } from './asynciterablex';\nimport { RefCountList } from '../iterable/_refcountlist';\n\nclass PublishedAsyncBuffer<T> extends MemoizeAsyncBuffer<T> {\n  // @ts-ignore\n  protected _buffer: RefCountList<T>;\n\n  constructor(source: AsyncIterator<T>) {\n    super(source, new RefCountList<T>(0));\n  }\n\n  [Symbol.asyncIterator]() {\n    this._buffer.readerCount++;\n    return this._getIterable(this._buffer.count)[Symbol.asyncIterator]();\n  }\n}\n\nexport function publish<TSource>(source: AsyncIterable<TSource>): AsyncIterableX<TSource>;\nexport function publish<TSource, TResult>(\n  source: AsyncIterable<TSource>,\n  selector?: (value: AsyncIterable<TSource>) => AsyncIterable<TResult>\n): AsyncIterableX<TResult>;\nexport function publish<TSource, TResult>(\n  source: AsyncIterable<TSource>,\n  selector?: (value: AsyncIterable<TSource>) => AsyncIterable<TResult>\n): AsyncIterableX<TSource | TResult> {\n  return selector\n    ? create(async () => selector(publish(source))[Symbol.asyncIterator]())\n    : new PublishedAsyncBuffer<TSource>(source[Symbol.asyncIterator]());\n}\n"]}