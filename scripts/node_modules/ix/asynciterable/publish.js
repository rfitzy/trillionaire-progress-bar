"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const create_1 = require("./create");
const memoize_1 = require("./memoize");
const _refcountlist_1 = require("../iterable/_refcountlist");
class PublishedAsyncBuffer extends memoize_1.MemoizeAsyncBuffer {
    constructor(source) {
        super(source, new _refcountlist_1.RefCountList(0));
    }
    [Symbol.asyncIterator]() {
        this._buffer.readerCount++;
        return this._getIterable(this._buffer.count)[Symbol.asyncIterator]();
    }
}
function publish(source, selector) {
    return selector
        ? create_1.create(async () => selector(publish(source))[Symbol.asyncIterator]())
        : new PublishedAsyncBuffer(source[Symbol.asyncIterator]());
}
exports.publish = publish;

//# sourceMappingURL=publish.js.map
